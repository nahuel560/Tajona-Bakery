(function(p){var v={menuFields:["menu-item-url","menu-item-title","menu-item-attr-title","menu-item-target","menu-item-classes","menu-item-xfn","menu-item-description","menu-item-featured-style","menu-item-featured-text","menu-item-icon","menu-submenu-width","menu-submenu-custom-width","menu-submenu-position","menu-submenu-transition"],menuSelectFieldDefault:{"menu-item-featured-style":"","menu-submenu-width":"auto","menu-submenu-position":"left","menu-submenu-transition":""},isSavingMenu:false,init:function(){this.initXMenuData();this.loadTemplates()},initXMenuData:function(){var e,n,a;for(a in xmenu_meta.data){xmenu_meta.data[a]["is_changed"]=false;for(e=0;e<v.menuFields.length;e++){n=v.menuFields[e];if(typeof xmenu_meta.data[a][n]=="undefined"){if(n in v.menuSelectFieldDefault){xmenu_meta.data[a][n]=v.menuSelectFieldDefault[n]}else{xmenu_meta.data[a][n]=""}}}}},loadTemplates:function(){p.ajax({url:xmenu_meta.ajax_url,data:{action:"xmenu_get_xmenu_panel"},success:function(e){if(p("#xmenu_panel").length==0){p("body").append('<div id="xmenu_panel"></div>')}p("#xmenu_panel").html(e);v.installListener();v.initXMenuButton()}})},installListener:function(){var a=this,e=p(".xmenu-panel-wrapper"),n=e.find(".xmenu-button-close"),t=e.find(".xmenu-sections"),i=e.find(".xmenu-tabs li"),u=e.find('[name="menu-item-featured-style"]'),m=e.find('[name="menu-item-featured-text"]'),s=e.find("#xmenu_submenu_width"),d=e.find("#xmenu_submenu_custom_width"),l=e.find(".xmenu-icon-wrapper"),o=e.find(".xmenu-icon-remove"),r=e.find(".xmenu-buttons"),f,c;t.perfectScrollbar({wheelSpeed:.5,suppressScrollX:true});i.on("click",function(){var e=p(this).data("section");i.removeClass("active");p(this).addClass("active");t.find(".xmenu-section-item").removeClass("active");t.find("#"+e).addClass("active");t.perfectScrollbar("update")});u.on("change",function(){var e=p(this).val();if(e!=""){m.parent().show()}else{m.parent().hide()}});s.on("change",function(){var e=p(this).val();if(e==="custom"){d.parent().show()}else{d.parent().hide()}});l.on("click",function(e){if(p(e.target).closest(".xmenu-icon-remove").length>0){return}var n=l.find('[name="menu-item-icon"]');GSF_ICON_POPUP.open(n.val(),function(e){a.setIcon(e);n.trigger("change")})});o.on("click",function(){v.setIcon("")});n.on("click",function(){e.removeClass("in")});this.windowKeyUp();this.saveMenu();this.saveAllMenu();this.eventChangedForXmenuField()},saveMenu:function(){var e=p(".xmenu-panel-wrapper"),n=e.find(".xmenu-buttons");n.find(".xmenu-button-save").on("click",function(){var e=p(".xmenu-panel-wrapper").data("menu-id");if(typeof e==="undefined"||e===null){return}v.saveMenuItems([e])})},saveAllMenu:function(){var e=p(".xmenu-panel-wrapper"),n=e.find(".xmenu-buttons");n.find(" > span").on("click",function(){n.find(".xmenu-save-all").fadeToggle()});p("body").on("click",function(e){if(p(e.target).closest(".xmenu-buttons > span").length){return}p(".xmenu-save-all").fadeOut()});n.find(".xmenu-save-all").on("click",function(){var e=[],n,a=0;for(n in xmenu_meta.data){if(xmenu_meta.data[n].is_changed){e[a++]=parseInt(n.replace("menu_",""),10)}}v.saveMenuItems(e)})},eventChangedForXmenuField:function(){var i=p(".xmenu-panel-wrapper"),e,n;for(e=0;e<v.menuFields.length;e++){n=v.menuFields[e];i.find('[name="'+n+'"]').on("change",function(){var e=p(this),n=i.data("menu-id"),a=e.attr("name");xmenu_meta.data["menu_"+n]["is_changed"]=true;p("#menu-item-"+n).find(".xmenu-item-config").addClass("is-changed");if(a==="menu-item-target"){if(e.prop("checked")){xmenu_meta.data["menu_"+n][a]=e.val()}else{xmenu_meta.data["menu_"+n][a]=""}}else{xmenu_meta.data["menu_"+n][a]=e.val()}var t=p("#menu-item-"+n).find('[name="'+a+"["+n+']"]');if(a==="menu-item-target"){t.prop("checked",e.prop("checked"))}else{t.val(e.val())}t.trigger("change")})}},initXMenuButton:function(){p("ul.menu > li.menu-item").each(function(){var e=parseInt(p(this).attr("id").replace("menu-item-",""),10);p("> .menu-item-bar > .menu-item-handle > span.item-title",this).append('<span class="xmenu-item-config" data-id="'+e+'"><i class="fa fa-cogs"></i> XMENU <i class="fa fa-warning"></i></span>')});p("ul.menu > li.menu-item .xmenu-item-config").on("click",function(){var e=parseInt(p(this).attr("data-id"),10);v.openXMenuPanel(e)})},openXMenuPanel:function(e){var n=p(".xmenu-panel-wrapper");if(n.hasClass(".xmenu-is-saving")){return}n.data("menu-id",e);n.addClass("in");var a=p(".xmenu-panel-wrapper"),t=a.find(".xmenu-icon-wrapper"),i=t.find(".xmenu-icon > div > i"),u=a.find("#xmenu_item_url"),m=a.find('[name="menu-item-featured-style"]'),s=a.find('[name="menu-item-featured-text"]'),d=a.find(".xmenu-title"),l=a.find("#xmenu_submenu_width"),o,r,f;d.text(xmenu_meta.data["menu_"+e]["menu-item-title"]);if(xmenu_meta.data["menu_"+e]["type"]==="custom"){u.removeAttr("readonly")}else{u.attr("readonly","readonly")}for(f=0;f<v.menuFields.length;f++){r=v.menuFields[f];o=a.find('[name="'+r+'"]');if(r==="menu-item-target"){o.prop("checked",xmenu_meta.data["menu_"+e][r]==="_blank")}else{o.val(xmenu_meta.data["menu_"+e][r])}if(r==="menu-item-icon"){i.attr("class",xmenu_meta.data["menu_"+e][r]);GSF_ICON_POPUP.svg_icon(t);if(xmenu_meta.data["menu_"+e][r]!==""){t.addClass("has-icon")}else{t.removeClass("has-icon")}}}if(m.val()!==""){s.parent().show()}else{s.parent().hide()}l.trigger("change")},setIcon:function(e){var n=p(".xmenu-icon-wrapper"),a=n.find('[name="menu-item-icon"]'),t=n.find(".xmenu-icon > div > i");a.val(e);t.attr("class",e);if(e==""){n.removeClass("has-icon")}else{n.addClass("has-icon")}GSF_ICON_POPUP.svg_icon(n);a.trigger("change")},windowKeyUp:function(){p(window).on("keyup",function(e){var n=e.keyCode?e.keyCode:e.which;if(n==27){var a=p(".xmenu-panel-wrapper");if(a.hasClass("in")){a.removeClass("in")}else{var t=a.data("menu-id");if(typeof t!="undefined"){a.addClass("in")}}p(".xmenu-icon-popup").fadeOut();p(".xmenu-save-all").fadeOut()}})},saveMenuItems:function(e){if(v.isSavingMenu){return}v.isSavingMenu=true;var n=p(".xmenu-button-save"),a=[],t=e.length,i;n.find("span").text(n.data("saving"));n.find("i").addClass("fa-spin fa-spinner");for(i=0;i<t;i++){a[i]={menu_id:e[i],data:xmenu_meta.data["menu_"+e[i]]}}p.ajax({url:xmenu_meta.ajax_url,type:"POST",data:{action:"xmenu_save_menu",data:a,nonce:p("#xmenu_nonce").val()},success:function(){v.isSavingMenu=false;n.find("span").text(n.data("save"));n.find("i").removeClass("fa-spin fa-spinner");for(i=0;i<t;i++){xmenu_meta.data["menu_"+e[i]].is_changed=false;p("#menu-item-"+e[i]).find(".xmenu-item-config").removeClass("is-changed")}},error:function(){v.isSavingMenu=false;n.find("span").text(n.data("save"));n.find("i").removeClass("fa-spin fa-spinner")}})}};p(document).ready(function(){v.init()})})(jQuery);