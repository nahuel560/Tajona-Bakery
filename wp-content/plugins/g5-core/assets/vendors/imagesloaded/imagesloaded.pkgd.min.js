(function(e,t){if(typeof define=="function"&&define.amd){define("ev-emitter/ev-emitter",t)}else if(typeof module=="object"&&module.exports){module.exports=t()}else{e.EvEmitter=t()}})(typeof window!="undefined"?window:this,function(){function e(){}var t=e.prototype;t.on=function(e,t){if(!e||!t){return}var i=this._events=this._events||{};var n=i[e]=i[e]||[];if(n.indexOf(t)==-1){n.push(t)}return this};t.once=function(e,t){if(!e||!t){return}this.on(e,t);var i=this._onceEvents=this._onceEvents||{};var n=i[e]=i[e]||{};n[t]=true;return this};t.off=function(e,t){var i=this._events&&this._events[e];if(!i||!i.length){return}var n=i.indexOf(t);if(n!=-1){i.splice(n,1)}return this};t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(!i||!i.length){return}var n=0;var r=i[n];t=t||[];var s=this._onceEvents&&this._onceEvents[e];while(r){var o=s&&s[r];if(o){this.off(e,r);delete s[r]}r.apply(this,t);n+=o?0:1;r=i[n]}return this};t.allOff=t.removeAllListeners=function(){delete this._events;delete this._onceEvents};return e});(function(t,i){"use strict";if(typeof define=="function"&&define.amd){define(["ev-emitter/ev-emitter"],function(e){return i(t,e)})}else if(typeof module=="object"&&module.exports){module.exports=i(t,require("ev-emitter"))}else{t.imagesLoaded=i(t,t.EvEmitter)}})(typeof window!=="undefined"?window:this,function e(t,i){var n=t.jQuery;var r=t.console;function s(e,t){for(var i in t){e[i]=t[i]}return e}function o(e){var t=[];if(Array.isArray(e)){t=e}else if(typeof e.length=="number"){for(var i=0;i<e.length;i++){t.push(e[i])}}else{t.push(e)}return t}function h(e,t,i){if(!(this instanceof h)){return new h(e,t,i)}if(typeof e=="string"){e=document.querySelectorAll(e)}this.elements=o(e);this.options=s({},this.options);if(typeof t=="function"){i=t}else{s(this.options,t)}if(i){this.on("always",i)}this.getImages();if(n){this.jqDeferred=new n.Deferred}setTimeout(function(){this.check()}.bind(this))}h.prototype=Object.create(i.prototype);h.prototype.options={};h.prototype.getImages=function(){this.images=[];this.elements.forEach(this.addElementImages,this)};h.prototype.addElementImages=function(e){if(e.nodeName=="IMG"){this.addImage(e)}if(this.options.background===true){this.addElementBackgroundImages(e)}var t=e.nodeType;if(!t||!a[t]){return}var i=e.querySelectorAll("img");for(var n=0;n<i.length;n++){var r=i[n];this.addImage(r)}if(typeof this.options.background=="string"){var s=e.querySelectorAll(this.options.background);for(n=0;n<s.length;n++){var o=s[n];this.addElementBackgroundImages(o)}}};var a={1:true,9:true,11:true};h.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(!t){return}var i=/url\((['"])?(.*?)\1\)/gi;var n=i.exec(t.backgroundImage);while(n!==null){var r=n&&n[2];if(r){this.addBackground(r,e)}n=i.exec(t.backgroundImage)}};h.prototype.addImage=function(e){var t=new f(e);this.images.push(t)};h.prototype.addBackground=function(e,t){var i=new u(e,t);this.images.push(i)};h.prototype.check=function(){var n=this;this.progressedCount=0;this.hasAnyBroken=false;if(!this.images.length){this.complete();return}function t(e,t,i){setTimeout(function(){n.progress(e,t,i)})}this.images.forEach(function(e){e.once("progress",t);e.check()})};h.prototype.progress=function(e,t,i){this.progressedCount++;this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;this.emitEvent("progress",[this,e,t]);if(this.jqDeferred&&this.jqDeferred.notify){this.jqDeferred.notify(this,e)}if(this.progressedCount==this.images.length){this.complete()}if(this.options.debug&&r){r.log("progress: "+i,e,t)}};h.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=true;this.emitEvent(e,[this]);this.emitEvent("always",[this]);if(this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}};function f(e){this.img=e}f.prototype=Object.create(i.prototype);f.prototype.check=function(){var e=this.getIsImageComplete();if(e){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}this.proxyImage=new Image;this.proxyImage.addEventListener("load",this);this.proxyImage.addEventListener("error",this);this.img.addEventListener("load",this);this.img.addEventListener("error",this);this.proxyImage.src=this.img.src};f.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth!==undefined};f.prototype.confirm=function(e,t){this.isLoaded=e;this.emitEvent("progress",[this,this.img,t])};f.prototype.handleEvent=function(e){var t="on"+e.type;if(this[t]){this[t](e)}};f.prototype.onload=function(){this.confirm(true,"onload");this.unbindEvents()};f.prototype.onerror=function(){this.confirm(false,"onerror");this.unbindEvents()};f.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this);this.proxyImage.removeEventListener("error",this);this.img.removeEventListener("load",this);this.img.removeEventListener("error",this)};function u(e,t){this.url=e;this.element=t;this.img=new Image}u.prototype=Object.create(f.prototype);u.prototype.check=function(){this.img.addEventListener("load",this);this.img.addEventListener("error",this);this.img.src=this.url;var e=this.getIsImageComplete();if(e){this.confirm(this.img.naturalWidth!==0,"naturalWidth");this.unbindEvents()}};u.prototype.unbindEvents=function(){this.img.removeEventListener("load",this);this.img.removeEventListener("error",this)};u.prototype.confirm=function(e,t){this.isLoaded=e;this.emitEvent("progress",[this,this.element,t])};h.makeJQueryPlugin=function(e){e=e||t.jQuery;if(!e){return}n=e;n.fn.imagesLoaded=function(e,t){var i=new h(this,e,t);return i.jqDeferred.promise(n(this))}};h.makeJQueryPlugin();return h});